This document contains information for those interested
in modifying the C source code of the VM, in particular
for cross-compilation to the H8300 microcontroller.

Cross-compiler for Unix
-----------------------
There are instructions for setting up a cross-compilation environment
at http://h8300-hms.sourceforge.net/ including both a binary and a
build-your-own option. I haven't actually tried them on Linux but they
work flawlessly on cygwin (which is a unix-like environment for
Windows). This site uses the most recent versions of the GNU
utilities and has improvements on the h8300 cross-compilation
environment.

Alternatively:

You should download binutils-2.9.1 and gcc-2.8.1 from
www.gnu.org, and install them, in that order, using:

	./configure --target=h8300-hitachi-hms --prefix=/usr/local
	make
	su
	make install
	
Create Makefile.config containing:

  BINDIR=/usr/local/bin
  BINPREFIX=h8300-hitachi-hms-


Cross-compiler for CygWin 1.3.2
-------------------------------
Download and install Cygwin from http://sources.redhat.com/cygwin/

Go to http://h8300-hms.sourceforge.net/ and follow the
instructions for building the tools yourself. You can
download the various packages required from
http://www.gnu.org/order/ftp.html

If you follow the instructions verbatim you will have to modify
Makefile.config in the lejos root directory to point BINDIR at
/usr/local/bin.

Following this procedure will provide you with the most up
to date versions of the tools.
 	

Cross-compiler for CygWin B20
-----------------------------
(Stolen from legOS pages at SourceForge)

This assumes CygWin B20. Download the cross-compiler from
http://legos.sourceforge.net/files/windows/cygwin/win-h8-egcs-1.1.2.zip
and unzip it in c:\cygnus\cygwin-b20\H-i586-cygwin32. Create a soft-link
from /bin to /cygnus/cygwin-b20/H-i586-cygwin32/bin.

Create Makefile.config containing:

  BINDIR=/cygnus/cygwin-b20/H-i586-cygwin32/bin
  BINPREFIX=h8300-hms-

Setting up the environment under CygWin can be problematic.
For reference, here's what my cygnus.bat file contains:

  @ECHO OFF
  SET MAKE_MODE=UNIX
  SET PATH=%PATH%;c:\cygnus\cygwin~1\h-i586~1\bin
  SET HOME=/home/jose
  bash

And this is what my $HOME/.bashrc file looks like:

  echo Running .bashrc

  export LEJOS_ROOT=//d/projects/lejos
  export LIBRCX_HOME=//d/projects/librcx
  export RCXTTY=COM2
  
  OLD_PATH=$PATH
  export PATH=/cygnus/cygwin-b20/H-i586-cygwin32/h8300-hms/bin/:/cygnus/cygwin-b20/H-i586-cygwin32/bin
  export PATH=$PATH:/cygnus/cygwin-b20/H-i586-cygwin32/lib/gcc-lib/h8300-hms/egcs-2.91.66/
  export PATH=$PATH://d/jdk1.2.2/bin
  export PATH=$PATH:$LEJOS_ROOT/bin
  export PATH=$PATH:$OLD_PATH
  


